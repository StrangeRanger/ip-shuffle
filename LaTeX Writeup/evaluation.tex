To evaluate the effectiveness of our IP shuffling script, we'll be adding an extra system to the virtual network with a static IP address of \texttt{192.168.1.10}. We'll set up an OPNsense instance as the default gateway for all virtual machines. This instance will be assigned the IP address \texttt{192.168.1.1}, acting as a simulated router that provides the DHCP service. As shown in Figure~\ref{fig:network-topology}, there will be two Ubuntu Linux machines and one instance of FreeBSD. Each machine will receive an IP address on initial startup starting at \texttt{192.168.1.100}, assigned by OPNsense. We'll give each system six minutes after startup to begin changing its IP address, after which we'll use an arp-scan using our extra machine to obtain the following output:
\begin{verbatim}
192.168.1.1     00:1c:42:c1:e4:da       (Unknown)
192.168.1.103   00:1c:42:c6:34:d1       (Unknown)
192.168.1.200   00:1c:42:98:99:4d       (Unknown)
192.168.1.236   00:1c:42:76:c0:7e       (Unknown)
\end{verbatim}
We can observe that the IP addresses, with the exception of the OPNsense instance, have been altered from their initially assigned addresses through DHCP. To check if the systems have changed their IPs once more, let's wait for another six minutes and then conduct another ARP scan. Here are the results of the said scan:
\begin{verbatim}
192.168.1.1     00:1c:42:c1:e4:da       (Unknown)
192.168.1.71    00:1c:42:76:c0:7e       (Unknown)
192.168.1.199   00:1c:42:c6:34:d1       (Unknown)
192.168.1.211   00:1c:42:98:99:4d       (Unknown)
\end{verbatim}
Let's cross-check the modified IP addresses with their respective MAC addresses to better understand their altered IPs.

\begin{tikzpicture}[ 
  node distance=1cm and 1.5cm,
  box/.style={rectangle, draw, minimum height=1cm, minimum width=4cm, align=center},
  arrow/.style={-Stealth, thick},
  scale=\linewidth/10cm, transform shape
]

  % Original IP-MAC pairs
  \node[box] (old1) {192.168.1.1\\00:1c:42:c1:e4:da};
  \node[box, below=of old1] (old2) {192.168.1.103\\00:1c:42:c6:34:d1};
  \node[box, below=of old2] (old3) {192.168.1.200\\00:1c:42:98:99:4d};
  \node[box, below=of old3] (old4) {192.168.1.236\\00:1c:42:76:c0:7e};

  % New IP-MAC pairs
  \node[box, right=of old1] (new1) {192.168.1.1\\00:1c:42:c1:e4:da};
  \node[box, below=of new1] (new2) {192.168.1.199\\00:1c:42:c6:34:d1};
  \node[box, below=of new2] (new3) {192.168.1.211\\00:1c:42:98:99:4d};
  \node[box, below=of new3] (new4) {192.168.1.71\\00:1c:42:76:c0:7e};

  % Arrows showing changes
  \draw[arrow] (old1) -- (new1);
  \draw[arrow] (old2) -- (new2);
  \draw[arrow] (old3) -- (new3);
  \draw[arrow] (old4) -- (new4);

  % Labels
  \node[above=of old1] (labelOld) {\textbf{Initial ARP Scan}};
  \node[above=of new1] (labelNew) {\textbf{ARP Scan After Six Minutes}};

\end{tikzpicture}

\subsection{Analysis and Observations}
Analyzing the IP shuffling technique involves evaluating its ability to prevent attackers from gaining valuable network reconnaissance information. Hereâ€™s a summary of our observations:
\begin{itemize}
\item \textbf{IP Address Changes:} The IP addresses changed significantly over the two arp-scans, making it difficult for an attacker to establish a static network view.
\item \textbf{MAC Address Consistency:} Each machine retained its MAC address throughout the scans, but the association between MAC addresses and IP addresses changed dynamically.
\item \textbf{Impact on Reconnaissance:} An attacker may struggle to perform effective reconnaissance and lateral movement as the IP addresses of potential targets keep changing, requiring constant rescanning of the subnet.
\end{itemize}

\subsection{Future Work and Limitations}

\begin{itemize}
\item \textbf{MTD Evasion Analysis:} Attackers may attempt to fingerprint devices based on other network characteristics like latency or open ports. Future work could include an analysis of such evasion techniques.
\item \textbf{MAC Address Fingerprinting Mitigation:} Although the IP addresses of the machines are shuffled, each machine retains its MAC address, which can be used to fingerprint it. Investigating ways to obscure MAC addresses or to randomly change them in addition to IP shuffling could significantly improve the effectiveness of the Moving Target Defense (MTD) strategy.
\item \textbf{Impact on Legitimate Users:} Changing IP addresses might also impact legitimate network users. Evaluating how legitimate users handle these changes could be a valuable direction for research.
\item \textbf{Integration with SDN:} Integration of this MTD technique with Software Defined Networking (SDN) could provide more robust and flexible defense mechanisms.
\end{itemize}